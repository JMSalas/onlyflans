{% extends 'base/base.html' %}
{% load static %}

{% block title %}
    {{ flan.name }}
{% endblock %}

{% block content %}
<div class="container px-3 text-center py-5 my-5">
    <div class="row justify-content-center mb-5">
        <div class="col-10 col-md-3 px-0 shadow-lg">
            <img class="img-fluid w-100 h-100" src="{{ flan.image_url }}" alt="{{ flan.name }}">
        </div>
        <div class="col-10 col-md-6 text-center d-flex flex-column px-0 shadow-lg">
            <div class="border-bottom border-info py-3">
                <span class="fw-bold h1">
                {{ flan.name }}
                {% if user.is_authenticated and is_favorito %}
                <i class="fa-solid fa-star fs-2" style="color: #FFD43B;"></i>
                {% endif %}
            </span>
            </div>
            
            <p class="fs-6 flex-grow-1 text-end px-2">{{ flan.description }}</p>

            <div class="mt-auto">            
                <p class="fs-4 fw-bold my-0" style="background-color:rgb(210, 224, 243);">$ {{ flan.precio }}</p>
                <div>
                {% if user.is_authenticated %}
                {% if is_favorito %}
                    <form method="post">
                        {% csrf_token %}
                        {{ delete_form.as_p }}
                        <input type="hidden" name="source" value="{{ source }}">
                        <button class="w-100 btn btn-info py-2 fw-bold" type="submit" name="delete_favorito"><i class="fa-solid fa-xmark" style="color: #eb0505;"></i> Eliminar de Favoritos</button>
                    </form>
                {% else %}
                    <form method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <input type="hidden" name="source" value="{{ source }}">
                        <button class="w-100 btn btn-info py-2 fw-bold" type="submit" name="add_favorito"><i class="fa-solid fa-star" style="color: #FFD43B;"></i> Agregar a Favoritos</button>
                    </form>
                {% endif %}
                {% endif %}
                </div>
            </div>
        </div>
    </div>
    <a href= "{% url 'index' %}" class="w-25 btn btn-secondary py-2 fw-bold mt-2"><i class="fa-solid fa-house"></i></a>
    {% if user.is_authenticated %}
    <a href= "{% url 'welcome' %}" class="w-25 btn btn-secondary py-2 fw-bold mt-2"><i class="fa-solid fa-heart"></i></a>
    <a href= "{% url 'favoritos' %}" class="w-25 btn btn-secondary py-2 fw-bold mt-2"><i class="fa-solid fa-star"></i></a>
    {% endif %}

    <div class="row py-3 px-5 mt-5 mb-3 border-top border-bottom border-info border-2">
    {% if not reviews %}
    
        {% if user.is_authenticated %}
        <h3>Deja la primera review de este flan.</h3>
        <span><a class="btn btn-info fw-bold" href="{% url 'review_flan' flan_slug=flan.slug %}"><i class="fa-solid fa-plus"></i><span class="d-none d-sm-block">Review</span></a></span>
        {% else %}
        <h3>No hay reviews disponibles</h3>
        {% endif %}
    {% else %}
        <div class="col-3 text-start">
            {% if user.is_authenticated %}
            <span><a class="btn btn-info fw-bold" href="{% url 'review_flan' flan_slug=flan.slug %}"><i class="fa-solid fa-plus"></i><span class="d-none d-sm-block">Review</span></a></span>
            {% endif %}
        </div>
        <div class="col-6 text-center pt-2">
            <span class="h3">Reviews</span>
        </div>
        <div class="col-3 text-end">
            <div class="fs-6 pe-2 fw-bold"><span class="d-none d-sm-block">Nota</span></div>
            <div class="badge bg-warning rounded-pill text-dark fs-5">{{ calificacion }}</div>
        </div>  
    </div>
    {% for review in reviews %}
    <div class="py-4 shadow" {% if forloop.counter|divisibleby:2 %}style="background-color:rgb(210, 224, 243);"{% endif%}>
        <div class="fs-5 pb-3">"{{ review.mensaje }}"</div>
        <div class="row">
            <div class="col fw-bold text-info">
                Usuario: <span class="text-dark">{{ review.id_user.first_name }} {{ review.id_user.last_name }}</span>
            </div>  
            <div class="col fw-bold text-info d-none d-sm-block">
                Fecha Creaci√≥n: <span class="text-dark">{{ review.date_created }}</span>
            </div>
            <div class="col fw-bold text-info">
                Nota: <span class="badge bg-secondary rounded-pill fs-6">{{ review.calificacion }}</span>         
            </div>
        </div>    
    </div>
    {% endfor %}
    {% endif %}
</div>
{% endblock %}
